# ========================================
# Docker 环境配置 - 库存服务
# ========================================

server:
  port: 9002

spring:
  application:
    name: seckill-stock

  # 数据源配置（使用环境变量）
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${MYSQL_HOST:mysql}:${MYSQL_PORT:3306}/seckill_stock?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8&allowPublicKeyRetrieval=true
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:root}
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
      idle-timeout: 30000
      pool-name: SeckillStockHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000

  # Nacos 配置
  cloud:
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:nacos:8848}
        namespace: public
      config:
        server-addr: ${NACOS_SERVER_ADDR:nacos:8848}
        file-extension: yml
        namespace: public

  # Redis 配置
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:root}
      database: 0
      timeout: 10000ms
      lettuce:
        pool:
          max-active: 50
          max-wait: -1ms
          max-idle: 20
          min-idle: 10

# RocketMQ 配置
rocketmq:
  name-server: ${ROCKETMQ_NAMESRV:rocketmq-namesrv:9876}
  producer:
    group: seckill-stock-producer
    send-message-timeout: 3000
    retry-times-when-send-failed: 3
    retry-times-when-send-async-failed: 3

# Sentinel 配置
feign:
  sentinel:
    enabled: true

sentinel:
  flow:
    seckill-qps: 1000
    goods-qps: 2000

# 秒杀配置
seckill:
  mq:
    topic: seckill-order-topic

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath:/mapper/**/*.xml
  type-aliases-package: com.seckill.stock.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# Actuator 监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: always
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# 日志配置
logging:
  level:
    com.seckill.stock: info
    com.seckill.stock.mapper: warn
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
